

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>python-openzwave hello_world &mdash; python-openzwave 0.2.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="python-openzwave 0.2.4 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">python-openzwave 0.2.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python-openzwave-hello-world">
<h1>python-openzwave hello_world<a class="headerlink" href="#python-openzwave-hello-world" title="Permalink to this headline">¶</a></h1>
<p>Here is the hello_world example for the python-openzwave API. In this
tutorial we will implement a simple sniffer. The full code is available
in the examples directory : hello_world.py.</p>
<div class="section" id="some-theory">
<h2>Some theory<a class="headerlink" href="#some-theory" title="Permalink to this headline">¶</a></h2>
<p>OpenZwave uses the mechanism of notifications to manage events network.
When the driver is ready, the node is added, a value is modified, ... openzwave
generates a notification you must catch with a callback function.</p>
<p>Python-openzwave API catch the notification and send a louie signal.</p>
<p>Some words about python-louie : it&#8217;s a simple mechanism where a dispatcher
send a signal on a channel, and clients connect to him.</p>
<p>Here is the way a sender dispatch a signal :</p>
<blockquote>
<div>dispatcher.send(self.SIGNAL_NODE, <a href="#id1"><span class="problematic" id="id2">**</span></a>{&#8216;network&#8217;: self, &#8216;node&#8217;:self.nodes[args[&#8216;nodeId&#8217;]]})</div></blockquote>
<p>Here is the way a client connect to a channel :</p>
<blockquote>
<div>dispatcher.connect(louie_node_update, ZWaveNetwork.SIGNAL_NODE)</div></blockquote>
<p>The first argument is a call back function :</p>
<blockquote>
<div><p>def louie_node_update(network, node):</p>
<blockquote>
<div>print(&#8216;Louie signal : Node update : %s.&#8217; % node)</div></blockquote>
</div></blockquote>
<p>It receives as parameters the ones populate by the sender : the network ans a node in ths case.
The callback must set its parameter names as the same as the sender.</p>
</div>
<div class="section" id="hello-from-zwave">
<h2>Hello from ZWave<a class="headerlink" href="#hello-from-zwave" title="Permalink to this headline">¶</a></h2>
<p>The import clauses :</p>
<blockquote>
<div><p>import openzwave</p>
<p>from openzwave.node import ZWaveNode</p>
<p>from openzwave.value import ZWaveValue</p>
<p>from openzwave.scene import ZWaveScene</p>
<p>from openzwave.controller import ZWaveController</p>
<p>from openzwave.network import ZWaveNetwork</p>
<p>from openzwave.option import ZWaveOption</p>
<p>import time</p>
<p>from louie import dispatcher, All</p>
</div></blockquote>
<p>First thing to do is to defined some options for the manager :</p>
<blockquote>
<div><p>options = ZWaveOption(device, config_path=&#8221;../openzwave/config&#8221;, user_path=&#8221;.&#8221;, cmd_line=&#8221;&#8221;)</p>
<p>options.set_log_file(&#8220;OZW_Log.log&#8221;)</p>
<p>options.set_append_log_file(False)</p>
<p>options.set_console_output(False)</p>
<p>options.set_save_log_level(&#8216;Debug&#8217;)</p>
<p>options.set_logging(True)</p>
<p>network = None</p>
</div></blockquote>
<p>We also defined a network object, we will populate it later.</p>
<p>To use this options, you must lock them. No further modification could be done on them.</p>
<blockquote>
<div>options.lock()</div></blockquote>
<p>We can now create the network :</p>
<blockquote>
<div>network = ZWaveNetwork(options, autostart=False)</div></blockquote>
</div>
<div class="section" id="the-signals-listeners">
<h2>The signals listeners<a class="headerlink" href="#the-signals-listeners" title="Permalink to this headline">¶</a></h2>
<p>We will now create some connection to the louie dispatcher. We will then to 3
main signals, they will notify us about the state of the network :</p>
<blockquote>
<div><p>dispatcher.connect(louie_network_started, ZWaveNetwork.SIGNAL_NETWORK_STARTED)</p>
<p>dispatcher.connect(louie_network_failed, ZWaveNetwork.SIGNAL_NETWORK_FAILED)</p>
<p>dispatcher.connect(louie_network_ready, ZWaveNetwork.SIGNAL_NETWORK_READY)</p>
</div></blockquote>
<p>To do that we use 3 callback functions :</p>
<p>When the driver is ready, we simply print some options on the screen :</p>
<blockquote>
<div><p>def louie_network_started(network):</p>
<blockquote>
<div>print(&#8220;Hello from network : I&#8217;m started : homeid %0.8x - %d nodes were found.&#8221; % (network.home_id, network.nodes_count))</div></blockquote>
</div></blockquote>
<p>When the driver fails, we reports the error to screen :</p>
<blockquote>
<div><p>def louie_network_failed(network):</p>
<blockquote>
<div>print(&#8220;Hello from network : can&#8217;t load :(.&#8221;)</div></blockquote>
</div></blockquote>
<p>This an important event. It means that all nodes have been queried on the network.
You can now use the network object pass in parameter to query nodes. To do that we connect
to some louie signals. It also sleep during 5 minutes. After that, the scripts
will continue and the network will be stopped.</p>
<blockquote>
<div><p>def louie_network_ready(network):</p>
<blockquote>
<div><p>print(&#8220;Hello from network : I&#8217;m ready : %d nodes were found.&#8221; % network.nodes_count)</p>
<p>print(&#8220;Hello from network : my controller is : %s&#8221; % network.controller)</p>
<p>dispatcher.connect(louie_node_update, ZWaveNetwork.SIGNAL_NODE)</p>
<p>dispatcher.connect(louie_value_update, ZWaveNetwork.SIGNAL_VALUE)</p>
</div></blockquote>
</div></blockquote>
<p>When a node is updated, added, removed, ...</p>
<blockquote>
<div><p>def louie_node_update(network, node):</p>
<blockquote>
<div>print(&#8216;Hello from node : %s.&#8217; % node)</div></blockquote>
</div></blockquote>
<p>When a value is updated, added, removed, ...</p>
<blockquote>
<div><p>def louie_value_update(network, node, value):</p>
<blockquote>
<div>print(&#8216;Hello from value : %s.&#8217; % value)</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="the-start-code">
<h2>The start code<a class="headerlink" href="#the-start-code" title="Permalink to this headline">¶</a></h2>
<p>We start the network</p>
<blockquote>
<div>network.start()</div></blockquote>
<p>And we wait for the network. You MUST NOT use the network objects before
network is ready.</p>
<blockquote>
<div><p>for i in range(0,90):</p>
<blockquote>
<div><p>if network.state&gt;=network.STATE_READY:</p>
<blockquote>
<div><p>print &#8220;<strong>*</strong> Network is ready&#8221;</p>
<p>break</p>
</div></blockquote>
<p>else:</p>
<blockquote>
<div><p>sys.stdout.write(&#8221;.&#8221;)</p>
<p>sys.stdout.flush()</p>
<p>time.sleep(1.0)</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>We now change the name of the controller. You will have a notification.</p>
<blockquote>
<div><p>network.controller.node.name = &#8220;Hello name&#8221;</p>
<p>time.sleep(10.0)</p>
</div></blockquote>
<p>Same when changing the location.</p>
<blockquote>
<div><p>network.controller.node.location = &#8220;Hello location&#8221;</p>
<p>time.sleep(120.0)</p>
</div></blockquote>
<p>And we wait for 2 minutes. If you have sensors on your network, you will
see the value notifications on the screen. If you have switch or dimmers,
activate them manually, ...</p>
<p>Now stop the network and release objects.</p>
<blockquote>
<div>network.stop()</div></blockquote>
<p>That&#8217;s all :)</p>
<p>Full source code is in examples/hello_world.py</p>
<p>To see a more functionnal example, look at ozwsh code.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">python-openzwave hello_world</a><ul>
<li><a class="reference internal" href="#some-theory">Some theory</a></li>
<li><a class="reference internal" href="#hello-from-zwave">Hello from ZWave</a></li>
<li><a class="reference internal" href="#the-signals-listeners">The signals listeners</a></li>
<li><a class="reference internal" href="#the-start-code">The start code</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/hello_world.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">python-openzwave 0.2.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, bibi21000.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>