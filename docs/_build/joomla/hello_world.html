

	
  <div class="section" id="python-openzwave-hello-world">
<h1>python-openzwave hello_world</h1>
<p>Here is the hello_world example for the python-openzwave API. In this
tutorial we will implement a simple sniffer. The full code is available
in the examples directory : hello_world.py.</p>
<div class="section" id="some-theory">
<h2>Some theory</h2>
<p>OpenZwave uses the mechanism of notifications to manage events network.
When the driver is ready, the node is added, a value is modified, ... openzwave
generates a notification you must catch with a callback function.</p>
<p>Python-openzwave API catch the notification and send a louie signal.</p>
<p>Some words about python-louie : it&#8217;s a simple mechanism where a dispatcher
send a signal on a channel, and clients connect to him.</p>
<p>Here is the way a sender dispatch a signal :</p>
<blockquote>
<div>dispatcher.send(self.SIGNAL_NODE, <a href="#id1"><span class="problematic" id="id2">**</span></a>{&#8216;network&#8217;: self, &#8216;node&#8217;:self.nodes[args[&#8216;nodeId&#8217;]]})</div></blockquote>
<p>Here is the way a client connect to a channel :</p>
<blockquote>
<div>dispatcher.connect(louie_node_update, ZWaveNetwork.SIGNAL_NODE)</div></blockquote>
<p>The first argument is a call back function :</p>
<blockquote>
<div><p>def louie_node_update(network, node):</p>
<blockquote>
<div>print(&#8216;Louie signal : Node update : %s.&#8217; % node)</div></blockquote>
</div></blockquote>
<p>It receives as parameters the ones populate by the sender : the network ans a node in ths case.
The callback must set its parameter names as the same as the sender.</p>
</div>
<div class="section" id="hello-from-zwave">
<h2>Hello from ZWave</h2>
<p>The import clauses :</p>
<blockquote>
<div><p>import openzwave</p>
<p>from openzwave.node import ZWaveNode</p>
<p>from openzwave.value import ZWaveValue</p>
<p>from openzwave.scene import ZWaveScene</p>
<p>from openzwave.controller import ZWaveController</p>
<p>from openzwave.network import ZWaveNetwork</p>
<p>from openzwave.option import ZWaveOption</p>
<p>import time</p>
<p>from louie import dispatcher, All</p>
</div></blockquote>
<p>First thing to do is to defined some options for the manager :</p>
<blockquote>
<div><p>options = ZWaveOption(device, config_path=&#8221;../openzwave/config&#8221;, user_path=&#8221;.&#8221;, cmd_line=&#8221;&#8221;)</p>
<p>options.set_log_file(&#8220;OZW_Log.log&#8221;)</p>
<p>options.set_append_log_file(False)</p>
<p>options.set_console_output(False)</p>
<p>options.set_save_log_level(&#8216;Debug&#8217;)</p>
<p>options.set_logging(True)</p>
<p>network = None</p>
</div></blockquote>
<p>We also defined a network object, we will populate it later.</p>
<p>To use this options, you must lock them. No further modification could be done on them.</p>
<blockquote>
<div>options.lock()</div></blockquote>
<p>We can now create the network :</p>
<blockquote>
<div>network = ZWaveNetwork(options, autostart=False)</div></blockquote>
</div>
<div class="section" id="the-signals-listeners">
<h2>The signals listeners</h2>
<p>We will now create some connection to the louie dispatcher. We will then to 3
main signals, they will notify us about the state of the network :</p>
<blockquote>
<div><p>dispatcher.connect(louie_driver_ready, ZWaveNetwork.SIGNAL_DRIVER_READY)</p>
<p>dispatcher.connect(louie_driver_failed, ZWaveNetwork.SIGNAL_DRIVER_FAILED)</p>
<p>dispatcher.connect(louie_network_ready, ZWaveNetwork.SIGNAL_NETWORK_READY)</p>
</div></blockquote>
<p>To do that we use 3 callback functions :</p>
<p>When the driver is ready, we simply print some options on the screen :</p>
<blockquote>
<div><p>def louie_driver_ready(network, controller):</p>
<blockquote>
<div>print(&#8220;Hello from driver : i&#8217;m ready : homeid %0.8x - %d nodes were found.&#8221; % (network.home_id, network.nodes_count))</div></blockquote>
</div></blockquote>
<p>When the driver fails, we reports the error to screen :</p>
<blockquote>
<div><p>def louie_driver_failed(network):</p>
<blockquote>
<div>print(&#8220;Hello from driver : can&#8217;t load :(.&#8221;)</div></blockquote>
</div></blockquote>
<p>This an important event. It means that all nodes have been queried on the network.
You can now use the network object pass in parameter to query nodes. To do that we connect
to some louie signals. It also sleep during 5 minutes. After that, the scripts
will continue and the network will be stopped.</p>
<blockquote>
<div><p>def louie_network_ready(network):</p>
<blockquote>
<div><p>print(&#8220;Hello from network : I&#8217;m ready : %d nodes were found.&#8221; % network.nodes_count)</p>
<p>print(&#8220;Hello from network : my controller is : %s&#8221; % network.controller)</p>
<p>dispatcher.connect(louie_node_update, ZWaveNetwork.SIGNAL_NODE)</p>
<p>dispatcher.connect(louie_value_update, ZWaveNetwork.SIGNAL_VALUE)</p>
<p>time.sleep(300.0)</p>
</div></blockquote>
</div></blockquote>
<p>When a node is updated, added, removed, ...</p>
<blockquote>
<div><p>def louie_node_update(network, node):</p>
<blockquote>
<div>print(&#8216;Hello from node : %s.&#8217; % node)</div></blockquote>
</div></blockquote>
<p>When a value is updated, added, removed, ...</p>
<blockquote>
<div><p>def louie_value_update(network, node, value):</p>
<blockquote>
<div>print(&#8216;Hello from value : %s.&#8217; % value)</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="the-start-code">
<h2>The start code</h2>
<p>We start the network</p>
<blockquote>
<div>network.start()</div></blockquote>
<p>And sleep for 2 minutes. If you have sensors on your network, you will
see the value notifications on the screen. If you have switch or dimmers,
activate them manually, ...</p>
<blockquote>
<div>time.sleep(120.0)</div></blockquote>
<p>We now change the name of the controller. You will also have a notification.</p>
<blockquote>
<div><p>network.controller.node.name = &#8220;Hello name&#8221;</p>
<p>time.sleep(30.0)</p>
</div></blockquote>
<p>Same when changing the location.</p>
<blockquote>
<div><p>network.controller.node.location = &#8220;Hello location&#8221;</p>
<p>time.sleep(120.0)</p>
</div></blockquote>
<p>Now stop the network and release objects.</p>
<blockquote>
<div>network.stop()</div></blockquote>
<p>That&#8217;s all :)</p>
<p>To see a more functionnal example, look at ozwsh code.</p>
</div>
</div>


